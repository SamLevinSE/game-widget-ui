import React, {Component} from 'react';

class Widget extends Component {
    constructor(props) {
        super(props);
        this.state = {
            items: [
                {
                    "id": 0,
                    "name": "Element 1"
                },
                {
                    "id": 1,
                    "name": "Element 2"
                },
                {
                    "id": 2,
                    "name": "Element 3"
                },
                {
                    "id": 3,
                    "name": "Element 4"
                },
                {
                    "id": 4,
                    "name": "Element 5"
                },
                {
                    "id": 5,
                    "name": "Element 6"
                },
                {
                    "id": 6,
                    "name": "Element 7"
                },
                {
                    "id": 7,
                    "name": "Element 8"
                },
                {
                    "id": 8,
                    "name": "Element 9"
                },
                {
                    "id": 9,
                    "name": "Element 10"
                },
                {
                    "id": 10,
                    "name": "Element 11"
                },
                {
                    "id": 11,
                    "name": "Element 12"
                },
                {
                    "id": 12,
                    "name": "Element 13"
                },
                {
                    "id": 13,
                    "name": "Element 14"
                },
                {
                    "id": 14,
                    "name": "Element 15"
                },
                {
                    "id": 15,
                    "name": "Element 16"
                },
                {
                    "id": 16,
                    "name": "Element 17"
                },
                {
                    "id": 17,
                    "name": "Element 18"
                },
                {
                    "id": 18,
                    "name": "Element 19"
                },
                {
                    "id": 19,
                    "name": "Element 20"
                },
                {
                    "id": 20,
                    "name": "Element 21"
                },
                {
                    "id": 21,
                    "name": "Element 22"
                },
                {
                    "id": 22,
                    "name": "Element 23"
                },
                {
                    "id": 23,
                    "name": "Element 24"
                },
                {
                    "id": 24,
                    "name": "Element 25"
                },
                {
                    "id": 25,
                    "name": "Element 26"
                },
                {
                    "id": 26,
                    "name": "Element 27"
                },
                {
                    "id": 27,
                    "name": "Element 28"
                },
                {
                    "id": 28,
                    "name": "Element 29"
                },
                {
                    "id": 29,
                    "name": "Element 30"
                },
                {
                    "id": 30,
                    "name": "Element 31"
                },
                {
                    "id": 31,
                    "name": "Element 32"
                },
                {
                    "id": 32,
                    "name": "Element 33"
                },
                {
                    "id": 33,
                    "name": "Element 34"
                },
                {
                    "id": 34,
                    "name": "Element 35"
                },
                {
                    "id": 35,
                    "name": "Element 36"
                },
                {
                    "id": 36,
                    "name": "Element 37"
                },
                {
                    "id": 37,
                    "name": "Element 38"
                },
                {
                    "id": 38,
                    "name": "Element 39"
                },
                {
                    "id": 39,
                    "name": "Element 40"
                },
                {
                    "id": 40,
                    "name": "Element 41"
                },
                {
                    "id": 41,
                    "name": "Element 42"
                },
                {
                    "id": 42,
                    "name": "Element 43"
                },
                {
                    "id": 43,
                    "name": "Element 44"
                },
                {
                    "id": 44,
                    "name": "Element 45"
                },
                {
                    "id": 45,
                    "name": "Element 46"
                },
                {
                    "id": 46,
                    "name": "Element 47"
                },
                {
                    "id": 47,
                    "name": "Element 48"
                },
                {
                    "id": 48,
                    "name": "Element 49"
                },
                {
                    "id": 49,
                    "name": "Element 50"
                },
                {
                    "id": 50,
                    "name": "Element 51"
                },
                {
                    "id": 51,
                    "name": "Element 52"
                },
                {
                    "id": 52,
                    "name": "Element 53"
                },
                {
                    "id": 53,
                    "name": "Element 54"
                },
                {
                    "id": 54,
                    "name": "Element 55"
                },
                {
                    "id": 55,
                    "name": "Element 56"
                },
                {
                    "id": 56,
                    "name": "Element 57"
                },
                {
                    "id": 57,
                    "name": "Element 58"
                },
                {
                    "id": 58,
                    "name": "Element 59"
                },
                {
                    "id": 59,
                    "name": "Element 60"
                },
                {
                    "id": 60,
                    "name": "Element 61"
                },
                {
                    "id": 61,
                    "name": "Element 62"
                },
                {
                    "id": 62,
                    "name": "Element 63"
                },
                {
                    "id": 63,
                    "name": "Element 64"
                },
                {
                    "id": 64,
                    "name": "Element 65"
                },
                {
                    "id": 65,
                    "name": "Element 66"
                },
                {
                    "id": 66,
                    "name": "Element 67"
                },
                {
                    "id": 67,
                    "name": "Element 68"
                },
                {
                    "id": 68,
                    "name": "Element 69"
                },
                {
                    "id": 69,
                    "name": "Element 70"
                },
                {
                    "id": 70,
                    "name": "Element 71"
                },
                {
                    "id": 71,
                    "name": "Element 72"
                },
                {
                    "id": 72,
                    "name": "Element 73"
                },
                {
                    "id": 73,
                    "name": "Element 74"
                },
                {
                    "id": 74,
                    "name": "Element 75"
                },
                {
                    "id": 75,
                    "name": "Element 76"
                },
                {
                    "id": 76,
                    "name": "Element 77"
                },
                {
                    "id": 77,
                    "name": "Element 78"
                },
                {
                    "id": 78,
                    "name": "Element 79"
                },
                {
                    "id": 79,
                    "name": "Element 80"
                },
                {
                    "id": 80,
                    "name": "Element 81"
                },
                {
                    "id": 81,
                    "name": "Element 82"
                },
                {
                    "id": 82,
                    "name": "Element 83"
                },
                {
                    "id": 83,
                    "name": "Element 84"
                },
                {
                    "id": 84,
                    "name": "Element 85"
                },
                {
                    "id": 85,
                    "name": "Element 86"
                },
                {
                    "id": 86,
                    "name": "Element 87"
                },
                {
                    "id": 87,
                    "name": "Element 88"
                },
                {
                    "id": 88,
                    "name": "Element 89"
                },
                {
                    "id": 89,
                    "name": "Element 90"
                },
                {
                    "id": 90,
                    "name": "Element 91"
                },
                {
                    "id": 91,
                    "name": "Element 92"
                },
                {
                    "id": 92,
                    "name": "Element 93"
                },
                {
                    "id": 93,
                    "name": "Element 94"
                },
                {
                    "id": 94,
                    "name": "Element 95"
                },
                {
                    "id": 95,
                    "name": "Element 96"
                },
                {
                    "id": 96,
                    "name": "Element 97"
                },
                {
                    "id": 97,
                    "name": "Element 98"
                },
                {
                    "id": 98,
                    "name": "Element 99"
                },
                {
                    "id": 99,
                    "name": "Element 100"
                },
                {
                    "id": 100,
                    "name": "Element 101"
                },
                {
                    "id": 101,
                    "name": "Element 102"
                },
                {
                    "id": 102,
                    "name": "Element 103"
                },
                {
                    "id": 103,
                    "name": "Element 104"
                },
                {
                    "id": 104,
                    "name": "Element 105"
                },
                {
                    "id": 105,
                    "name": "Element 106"
                },
                {
                    "id": 106,
                    "name": "Element 107"
                },
                {
                    "id": 107,
                    "name": "Element 108"
                },
                {
                    "id": 108,
                    "name": "Element 109"
                },
                {
                    "id": 109,
                    "name": "Element 110"
                },
                {
                    "id": 110,
                    "name": "Element 111"
                },
                {
                    "id": 111,
                    "name": "Element 112"
                },
                {
                    "id": 112,
                    "name": "Element 113"
                },
                {
                    "id": 113,
                    "name": "Element 114"
                },
                {
                    "id": 114,
                    "name": "Element 115"
                },
                {
                    "id": 115,
                    "name": "Element 116"
                },
                {
                    "id": 116,
                    "name": "Element 117"
                },
                {
                    "id": 117,
                    "name": "Element 118"
                },
                {
                    "id": 118,
                    "name": "Element 119"
                },
                {
                    "id": 119,
                    "name": "Element 120"
                },
                {
                    "id": 120,
                    "name": "Element 121"
                },
                {
                    "id": 121,
                    "name": "Element 122"
                },
                {
                    "id": 122,
                    "name": "Element 123"
                },
                {
                    "id": 123,
                    "name": "Element 124"
                },
                {
                    "id": 124,
                    "name": "Element 125"
                },
                {
                    "id": 125,
                    "name": "Element 126"
                },
                {
                    "id": 126,
                    "name": "Element 127"
                },
                {
                    "id": 127,
                    "name": "Element 128"
                },
                {
                    "id": 128,
                    "name": "Element 129"
                },
                {
                    "id": 129,
                    "name": "Element 130"
                },
                {
                    "id": 130,
                    "name": "Element 131"
                },
                {
                    "id": 131,
                    "name": "Element 132"
                },
                {
                    "id": 132,
                    "name": "Element 133"
                },
                {
                    "id": 133,
                    "name": "Element 134"
                },
                {
                    "id": 134,
                    "name": "Element 135"
                },
                {
                    "id": 135,
                    "name": "Element 136"
                },
                {
                    "id": 136,
                    "name": "Element 137"
                },
                {
                    "id": 137,
                    "name": "Element 138"
                },
                {
                    "id": 138,
                    "name": "Element 139"
                },
                {
                    "id": 139,
                    "name": "Element 140"
                },
                {
                    "id": 140,
                    "name": "Element 141"
                },
                {
                    "id": 141,
                    "name": "Element 142"
                },
                {
                    "id": 142,
                    "name": "Element 143"
                },
                {
                    "id": 143,
                    "name": "Element 144"
                },
                {
                    "id": 144,
                    "name": "Element 145"
                },
                {
                    "id": 145,
                    "name": "Element 146"
                },
                {
                    "id": 146,
                    "name": "Element 147"
                },
                {
                    "id": 147,
                    "name": "Element 148"
                },
                {
                    "id": 148,
                    "name": "Element 149"
                },
                {
                    "id": 149,
                    "name": "Element 150"
                },
                {
                    "id": 150,
                    "name": "Element 151"
                },
                {
                    "id": 151,
                    "name": "Element 152"
                },
                {
                    "id": 152,
                    "name": "Element 153"
                },
                {
                    "id": 153,
                    "name": "Element 154"
                },
                {
                    "id": 154,
                    "name": "Element 155"
                },
                {
                    "id": 155,
                    "name": "Element 156"
                },
                {
                    "id": 156,
                    "name": "Element 157"
                },
                {
                    "id": 157,
                    "name": "Element 158"
                },
                {
                    "id": 158,
                    "name": "Element 159"
                },
                {
                    "id": 159,
                    "name": "Element 160"
                },
                {
                    "id": 160,
                    "name": "Element 161"
                },
                {
                    "id": 161,
                    "name": "Element 162"
                },
                {
                    "id": 162,
                    "name": "Element 163"
                },
                {
                    "id": 163,
                    "name": "Element 164"
                },
                {
                    "id": 164,
                    "name": "Element 165"
                },
                {
                    "id": 165,
                    "name": "Element 166"
                },
                {
                    "id": 166,
                    "name": "Element 167"
                },
                {
                    "id": 167,
                    "name": "Element 168"
                },
                {
                    "id": 168,
                    "name": "Element 169"
                },
                {
                    "id": 169,
                    "name": "Element 170"
                },
                {
                    "id": 170,
                    "name": "Element 171"
                },
                {
                    "id": 171,
                    "name": "Element 172"
                },
                {
                    "id": 172,
                    "name": "Element 173"
                },
                {
                    "id": 173,
                    "name": "Element 174"
                },
                {
                    "id": 174,
                    "name": "Element 175"
                },
                {
                    "id": 175,
                    "name": "Element 176"
                },
                {
                    "id": 176,
                    "name": "Element 177"
                },
                {
                    "id": 177,
                    "name": "Element 178"
                },
                {
                    "id": 178,
                    "name": "Element 179"
                },
                {
                    "id": 179,
                    "name": "Element 180"
                },
                {
                    "id": 180,
                    "name": "Element 181"
                },
                {
                    "id": 181,
                    "name": "Element 182"
                },
                {
                    "id": 182,
                    "name": "Element 183"
                },
                {
                    "id": 183,
                    "name": "Element 184"
                },
                {
                    "id": 184,
                    "name": "Element 185"
                },
                {
                    "id": 185,
                    "name": "Element 186"
                },
                {
                    "id": 186,
                    "name": "Element 187"
                },
                {
                    "id": 187,
                    "name": "Element 188"
                },
                {
                    "id": 188,
                    "name": "Element 189"
                },
                {
                    "id": 189,
                    "name": "Element 190"
                },
                {
                    "id": 190,
                    "name": "Element 191"
                },
                {
                    "id": 191,
                    "name": "Element 192"
                },
                {
                    "id": 192,
                    "name": "Element 193"
                },
                {
                    "id": 193,
                    "name": "Element 194"
                },
                {
                    "id": 194,
                    "name": "Element 195"
                },
                {
                    "id": 195,
                    "name": "Element 196"
                },
                {
                    "id": 196,
                    "name": "Element 197"
                },
                {
                    "id": 197,
                    "name": "Element 198"
                },
                {
                    "id": 198,
                    "name": "Element 199"
                },
                {
                    "id": 199,
                    "name": "Element 200"
                }
            ],
            selectedItems: [
                "Element 2", "Element 186"
            ],
            tempSelectedItems: [],
            selectFilter: 10,
            maxSelect: 3,
            showSelect: false,
            search: ""
        }
    }

    // This method will remove the element by pressing the X button
    removeItem = (item) => {
        const {selectedItems} = this.state;
        for (let i = 0; i < selectedItems.length; i++) {
            if (item === selectedItems[i]) {
                selectedItems.splice(i, 1)
            }
        }
        // update the state
        this.setState({
            "selectedItems": selectedItems
        });
    };

    // This method will remove the unsaved element by pressing the X button
    removeTempItem = (item) => {
        const {tempSelectedItems} = this.state;
        for (let i = 0; i < tempSelectedItems.length; i++) {
            if (item === tempSelectedItems[i]) {
                tempSelectedItems.splice(i, 1)
            }
        }
        // update the state
        this.setState({
            "tempSelectedItems": tempSelectedItems
        });
    };

    // This method will show and/or hide selecting section
    showHideSelectItems = () => {
        let bool;
        this.state.showSelect ? bool = false : bool = true;
        this.setState({
            showSelect: bool
        })
    };

    // This method will change/update the selectFilter (state). If the filter is set to NoFilter, it will show all 200 items
    filterChange = (event) => {
        let value = null;
        const noFilter = "NoFilter";
        event.target.value === noFilter ? value = 200 : value = event.target.value;
        this.setState({"selectFilter": value})
    };

    // This method will remove or add an item by checking the checkbox next to the items
    handleInputChange = (e, item) => {
        const isChecked = e.target.checked;
        this.setState((prevState) => {
            if (isChecked === true && prevState.tempSelectedItems.length < prevState.maxSelect) {
                const newState = prevState.tempSelectedItems;
                newState.push(item);
                this.setState({tempSelectedItems: newState});
            } else if (!isChecked) {
                const newState = prevState.tempSelectedItems;
                for (let j = 0; j < prevState.tempSelectedItems.length; j++) {
                    if (item === newState[j]) {
                        newState.splice(j, 1);
                    }
                }
                this.setState({tempSelectedItems: newState});
            }
        });
    };

    // This method will update the search (state) each time a user press a key
    updateSearch = (e) => {
        this.setState({
            search: e.target.value
        })
    };

    // This method will save all the new selected items to the selectedItems (state)
    saveSelectItems = () => {
        const {tempSelectedItems} = this.state;
        tempSelectedItems.length > 0 ?
            this.setState({selectedItems: tempSelectedItems}) : alert("Nothing to save!");
        this.showHideSelectItems()
    };

    // This method will remove all the new unsaved items in the state and then will hide the select section.
    cancelSelectItems = () => {
        this.showHideSelectItems();
        this.setState({tempSelectedItems: []});
    };

    render() {
        // listing selected items
        const {selectedItems} = this.state;
        const selectedItem = selectedItems.map((item) => (
            <div className="itemBox"
                 key={item}>
                <p>
                    {item}
                </p>
                <button onClick={this.removeItem.bind(this, item)}>X</button>
            </div>
        ));

        // listing unsaved selected items
        const {tempSelectedItems} = this.state;
        const tempSelectedItem = tempSelectedItems.length > 0 ? tempSelectedItems.map((item) => (
            <div className="itemBox"
                 key={item}>
                <p>
                    {item}
                </p>
                <button onClick={this.removeTempItem.bind(this, item)}>X</button>
            </div>
        )) : null;

        //filtering
        const allItems = this.state.items.filter(item => {
            return item.name.toLowerCase().indexOf(this.state.search.toLowerCase()) !== -1
        }).slice(0, this.state.selectFilter);

        return (
            <div className="widgetArea">
                <>
                    <h1>Select items</h1>
                    <p>You currently have {this.state.selectedItems.length} selected items</p>
                    <div className="listItemBox">
                        {selectedItem}
                    </div>
                    <div className="listItemBox">
                        <button
                            className="btnChange"
                            onClick={this.showHideSelectItems}>
                            Change My Choice
                        </button>
                    </div>
                </>
                <div className="widgetItemSelect" style={{display: this.state.showSelect === false ? "none" : "block"}}>
                    <h3>Select items</h3>
                    <div className="widgetFlex">
                        <div className="widgetGrid">
                            <label>Search </label>
                            <input
                                value={this.state.search}
                                onChange={this.updateSearch.bind(this)}
                                type="text"/>
                        </div>
                        <div className="widgetGrid">
                            <label>Filter </label>
                            <div className="selectBox">
                                <select
                                    value={this.state.selectFilter}
                                    onChange={this.filterChange}>
                                    <option value="NoFilter">No Filter</option>
                                    <option value="10"> > 10</option>
                                    <option value="100"> > 100</option>
                                    <option value="200"> > 200</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div className="selectItemBox">
                        <form>
                            {allItems.map((item) => (
                                <p key={item.id}>
                                    <input
                                        type="checkBox"
                                        onChange={(e) => this.handleInputChange(e, item.name)}
                                        value={item.name}/>
                                    <label>{item.name}</label>
                                </p>
                            ))}
                        </form>
                    </div>
                    <p>Current Selected Items:</p>
                    <div className="listItemBox">
                        {tempSelectedItem}
                    </div>
                    <div className="listItemBox">
                        <button
                            className="btnChange"
                            onClick={this.saveSelectItems}>
                            Save
                        </button>
                        <button
                            className="btnChange"
                            onClick={this.cancelSelectItems}>
                            Cancel
                        </button>
                    </div>
                </div>
            </div>

        );
    }
}

export default Widget;